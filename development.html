<!-- =================================================================================== -->
<!-- THIS PAGE WAS GENERATED. DO NOT MODIFY IT!!! -->
<!-- Instead edit the *.adoc files at: -->

<!-- https://github.com/babun/babun/tree/master/babun-doc/adoc-->

<!-- =================================================================================== -->

<!DOCTYPE html>
<html lang="en">
  <head profile="http://www.w3.org/2005/10/profile">
    <meta charset="utf-8"/>
    <title>Babun - a windows shell you will love!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Lukasz Pielak">
    <meta name="keywords" content="babun, shell, cygwin, console">
    <meta name="generator" content="JBake">

    <!--  -->

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">

    
        <link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="http://babun.github.io/favicon.ico" />
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
   

		<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Babun (pronounced Baboon)</a>
        </div>
        <div class="navbar-collapse collapse navbar-right">
          <ul class="nav navbar-nav">
            <li><a href="index.html">About</a></li>
            <li><a href="screenshots.html">Screenshots</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="development.html">Development</a></li>
            <!--<li><a href="feed.xml">Subscribe</a></li>-->
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Social <b class="caret"></b></a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a href="https://gitter.im/babun/babun" target="_blank">
                  <i class="fa fa-comments"></i> &nbsp; Discuss on Gitter
                </a></li>
                <li><a href="https://twitter.com/babunshell" target="_blank">
                  <i class="fa fa-file-text-o"></i> &nbsp; Follow us on Twitter
                </a>
                <a href="http://github.com/babun/babun" target="_blank">
                  <i class="fa fa-github"></i> &nbsp; Get sources from GitHub
                </a></li>
                
                <!--<li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>-->
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    
  <div class="container-fluid page-title">
    <div class="row">
        <div class="col-lg-12 columns">
          <h1 class="shadow">Babun</h1>
          <h3>a Windows shell you will love!</h3>
          <p class="shadow">
              <!--<a class="btn btn-success" href="http://projects.reficio.org/babun/download" role="button" onclick="trackOutboundLink('http://projects.reficio.org/babun/download'); return false;"> -->
              <a class="btn btn-success" href="http://projects.reficio.org/babun/download" role="button"> 
                <i class="fa fa-download"></i> &nbsp; Download now
              </a> &nbsp;&nbsp;&nbsp;

              <a class="btn btn-primary" href="http://github.com/babun/babun" target="_blank" role="button">
                 <i class="fa fa-github"></i> &nbsp; Visit us on GitHub
              </a>              
          </p>
          
          
<div class="container social">
<p>
    <ul class="list-inline">
      <li>
        <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=babun&amp;repo=babun&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="100px" height="20px" kwframeid="1"></iframe>
      </li>
      <li class="tweet-btn hidden-phone">
        <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="http://platform.twitter.com/widgets/tweet_button.23a4a4933995b86880bb787f8ff6a082.en.html#_=1428183100291&amp;count=horizontal&amp;dnt=false&amp;id=twitter-widget-0&amp;lang=en&amp;original_referer=http%3A%2F%2Fbabun.github.io%2F&amp;related=davegandy%3ACreator%20of%20Font%20Awesome&amp;size=m&amp;text=Babun%20-%20a%20windows%20shell%20you%20will%20love!&amp;url=http%3A%2F%2Fbabun.github.io&amp;via=babunshell" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-horizontal" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 100px; height: 20px;" kwframeid="4"></iframe>
      </li>
      <li class="follow-btn">
        <iframe id="twitter-widget-1" scrolling="no" frameborder="0" allowtransparency="true" src="http://platform.twitter.com/widgets/follow_button.08f0c3c199f04970eb80d854774cbb2e.en.html#_=1428183100295&amp;dnt=false&amp;id=twitter-widget-1&amp;lang=en&amp;screen_name=babunshell&amp;show_count=true&amp;show_screen_name=false&amp;size=m" class="twitter-follow-button twitter-follow-button" title="Twitter Follow Button" data-twttr-rendered="true" style="width: 140px; height: 20px;" kwframeid="3"></iframe>
      </li>
    </ul>

  </p>
    
</div>
        </div>
      </div>
    </div>

<div class="container">

	
	<div class="page-header">
		<h1>Development</h1>
	</div>

	

	<p><div class="sect1">
<h2 id="_project_structure">Project structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The project consists of five modules.</p>
</div>
<div class="sect2">
<h3 id="_babun_packages">babun-packages</h3>
<div class="paragraph">
<p>The main goal of the <code>babun-packages</code> module is to download the cygwin packages listed in the <code>conf/cygwin.x86.packages</code> file.
The above mentioned packages will be downloaded together with the whole dependency tree. Repositories which the packages are downloaded from are listed in the <code>conf/cygwin.repositories</code> file. At the beginning the first repository is taken, if a package is not available in this repo the second repo is used, etc. The process continues until all packages have been downloaded.</p>
</div>
<div class="paragraph">
<p>All downloaded packages are stored in the <code>target/babun-packages</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_babun_cygwin">babun-cygwin</h3>
<div class="paragraph">
<p>The main goal of the <code>babun-cygwin</code> module is to download and invoke the native cygwin.exe installer. The packages downloaded by the babun-packages module are used as the input - all of them will be installed in the offline cygwin installation.</p>
</div>
<div class="paragraph">
<p>It is not trivial to install and zip a local instance of Cygwin - there are problems with the symlinks as the symlink-file-flags are lost during the compression process. Babun can work it around though. At first, just after the installation, the <code>symlinks_find.sh</code> script is invoked in order to store the list of all cygwin&#8217;s symlinks. This file is delivered as a part of the babun&#8217;s core. Then, after babun is installed from the zip file on the user&#8217;s host the <code>symlinks_repair.sh</code> script is invoked - it will correct all the broken symlinks listed in the above mentioned file.</p>
</div>
<div class="paragraph">
<p>Preinstalled cygwin is located in the <code>target/babun-cygwin</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_babun_core">babun-core</h3>
<div class="paragraph">
<p>The main goal of the <code>babun-core</code> module is to install babun&#8217;s core along with all the plugins and tools. <code>install.sh</code> script is invoked during the creation of the distribution package in order to preinstall the plugins. Whenever babun is installed on the user&#8217;s host the <code>install_home.sh</code> script is invoked in order to install the babun-related files to the cygwin-user&#8217;s home folder.</p>
</div>
<div class="paragraph">
<p>Preinstalled cygwin with installed babun is located in the <code>target/babun-cygwin</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_babun_dist">babun-dist</h3>
<div class="paragraph">
<p>The main goal of the <code>babun-dist</code> module is to zip the ready-made instance of babun, copy some installation scripts and zip the distribution.</p>
</div>
<div class="paragraph">
<p>Distribution package is located in the <code>target/babun-dist</code> folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_babun_doc">babun-doc</h3>
<div class="paragraph">
<p>This module contains documentation written in ASCIIDOC.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_from_source">Building from source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The project is regularly built using Jenkins, on a slave node featuring the Windows Server OS. The Windows OS is required to fully build the distribution package as one of the goals invokes the native <code>cygwin.exe</code> installer. The artifacts created by each module are cached/stored in the target folder after a successful build of each step. This mechanism is not intelligent enough to calculate the diffs so if you would like to fully rebuild the whole dist package make sure to invoke the <code>clean</code> goal before the <code>package</code> goal. For now it&#8217;s not possible to invoke a build of selective modules only.</p>
</div>
<div class="paragraph">
<p>In order to build the dist package invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy build.groovy package</pre>
</div>
</div>
<div class="paragraph">
<p>In order to clean the project target folder invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy build.groovy clean</pre>
</div>
</div>
<div class="paragraph">
<p>In order to publish the release version to bintray invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy build.groovy release</pre>
</div>
</div>
<div class="paragraph">
<p>The release goal expects the following environment variables: <code>bintray_user</code> and <code>bintray_secret</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_developing_a_plugin">Developing a plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every plugin has to consist of three main files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install.sh - a file that will be executed during the creation of the babun&#8217;s distribution</p>
</li>
<li>
<p>install_home.sh - a file that will be executed during the installation of babun to the user&#8217;s home folder</p>
</li>
<li>
<p>plugin.desc - a plugin description that contains the plugin_name and plugin_version variables</p>
</li>
<li>
<p>start.sh (optional) - a file that will be executed on babun startup</p>
</li>
<li>
<p>exec.sh (optional) - a file that allows adding commands to babun script</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have a look at the pact plugin - it&#8217;s a perfect example of a relatively small plugin using all the features.</p>
</div>
<div class="sect2">
<h3 id="_install_sh">install.sh</h3>
<div class="paragraph">
<p>Its main responsibility is to install the plugin - for example to copy the plugin files to, e.g. <code>/usr/local/etc</code> or <code>/usr/local/bin</code> directories. install.sh script is also responsible for preparing the user&#8217;s home folder template. The template files have to be copied to the <code>/usr/local/babun/home/&lt;plugin_name&gt;</code> folder.</p>
</div>
<div class="paragraph">
<p>install.sh will be invoked many times - on every plugin update if the plugin version is higher than the version of the installed plugin - thus it&#8217;s logic has to work in an incremental way. This mechanism is invoked automatically though. The plugin does not have to contain the version check.</p>
</div>
<div class="paragraph">
<p>The script has to begin with the following statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash
set -e -f -o pipefail
source "/usr/local/etc/babun/source/babun-core/tools/script.sh"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_home_sh">install_home.sh</h3>
<div class="paragraph">
<p>Its main responsibility is to configure the user&#8217;s home folder with the plugin related stuff, if necessary. For example, it may copy the files from the <code>/usr/local/babun/home/&lt;plugin_name&gt;</code> folder to the user&#8217;s home folder.
It is also responsible for any other things that may be necessary during the user&#8217;s home configuration process.</p>
</div>
<div class="paragraph">
<p>install_home.sh will be invoked many times - on every plugin update if the plugin version is higher than the version of the installed plugin - thus it&#8217;s logic has to work in an incremental way.</p>
</div>
<div class="paragraph">
<p>Both scripts (install.sh and install_home.sh) scripts have to begin with the following statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash
set -e -f -o pipefail
source "/usr/local/etc/babun/source/babun-core/tools/script.sh"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uninstall_sh_optional">uninstall.sh (optional)</h3>
<div class="paragraph">
<p>Its responsibility is to cleanup all entries that a plugin may leave for example on the filesystem or in the windows registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_desc">plugin.desc</h3>
<div class="paragraph">
<p>A plugin descriptor looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># plugin descriptor
plugin_name=pact
plugin_version=1</pre>
</div>
</div>
<div class="paragraph">
<p>Every time the plugin is changed the version has to be incremented. Otherwise the newest version will not be installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_start_sh_optional">start.sh (optional)</h3>
<div class="paragraph">
<p>The start.sh is an optional script for plugins that require triggering certain actions on every babun start (for example update check).</p>
</div>
</div>
<div class="sect2">
<h3 id="_exec_sh_optional">exec.sh (optional)</h3>
<div class="paragraph">
<p>If the plugin folder contains an exec.sh script,
whenever <code>babun &lt;plugin_name&gt; xxx yyy</code> command is invoked, the execution is passed to <code>&lt;plugin_name&gt;/exec.sh</code> script with params <code>xxx yyy</code>.
In this way a plugin may add some additional shell commands without implementing its own <code>/usr/local/bin/xxx</code> script.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_branches">Branches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The babun&#8217;s repository contains three main branches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>master - development branch</p>
</li>
<li>
<p>candidate - release candidate branch, no direct commits, only fast forwards from the master/other branch</p>
</li>
<li>
<p>release - release, no direct commits, only fast forwards from the candidate branch</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to check babun update against other branch (for example during a development of a plugin), set the babun_branch variable to (master or candidate). External repo&#8217;s are not supporter (this mechanism has to be extended to include user&#8217;s repos).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_folder_structure_in_cygwin">Folder structure in Cygwin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An instance of babun installed in Cygwin is located in the <code>/usr/local/etc/babun</code> folder.
The folder structure looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── babun
│   ├── external
│   │   └── oh-my-zsh
│   ├── home
│   │   ├── core
│   │   ├── oh-my-zsh
│   │   ├── pact
│   │   └── shell
│   ├── installed
│   │   ├── babun
│   │   ├── cacert
│   │   ├── core
│   │   ├── git
│   │   ├── oh-my-zsh
│   │   ├── pact
│   │   └── shell
│   ├── source
│   │   ├── babun.version
│   │   ├── babun-core
│   │   ├── babun-cygwin
│   │   ├── babun-dist
│   │   ├── babun-doc
│   │   ├── babun-packages
│   │   ├── build.groovy
│   │   └── README.adoc
│   └── stamps
│       ├── check
│       └── welcome
├── babun.bash
├── babun.instance
├── babun.rc
├── babun.start
└── babun.zsh

16 directories, 17 files</pre>
</div>
</div>
<div class="sect2">
<h3 id="_source">source</h3>
<div class="paragraph">
<p>The folder contains the sources of babun checkout from github.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stamps">stamps</h3>
<div class="paragraph">
<p>The folder contains files which modification time indicates certain things to babun. For example <code>babun check</code> is executed automatically on babun&#8217;s start up every 24 hours. Whenever it&#8217;s invoked a file named <code>checked</code> is being modified (the content of the modification does not matter).Whenever the mod_time of this file is not within 24 hours and babun is being started a <code>babun check</code> will be invoked and the file <code>check</code> located in the <code>stamps</code> folder will be modified again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installed">installed</h3>
<div class="paragraph">
<p>The folder contains files that indicated which versions of babun&#8217;s plugins and babun itself are installed. Each file contains a number - for example: a file named <code>core</code> contains has one line with number <code>2</code> in its content. It means that the plugin <code>core</code> is installed and has version <code>2</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_external">external</h3>
<div class="paragraph">
<p>The folder contains external resources, like cloned repos of other projects (for example oh-my-zsh).</p>
</div>
</div>
<div class="sect2">
<h3 id="_home">home</h3>
<div class="paragraph">
<p>The folder contains folders named like plugins. If a plugin needs to install something to user&#8217;s folder this content has to be copied to <code>home/&lt;plugin_name&gt;</code> folder. It&#8217;s just a store of the user&#8217;s home files, so that whenever a new user&#8217;s account is created babun can install user&#8217;s home related content to the user&#8217;s home folder (it&#8217;s the plugin install_home.sh script&#8217;s responsibility, however, to copy this content to the actual user&#8217;s home folder).</p>
</div>
</div>
</div>
</div></p>

	<hr />

	</div>
  </div> 
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">
          &copy; Babun Team 2015 | Babun is licensed under the Apache License v2. | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.3.2</a>.
        </p>
      </div>
    </div>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/prettify.js"></script>
    
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-51064780-1', 'babun.github.io');
ga('send', 'pageview');
</script>

<script>
var trackOutboundLink = function(url) {
   ga('send', 'event', 'outbound', 'click', url, {'hitCallback':
     function () {
     document.location = url;
     }
   });
}
</script>

  </body>
</html>